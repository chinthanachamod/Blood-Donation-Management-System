<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Dashboard | Blood Donation System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>

        .card {
            overflow: hidden;
            transition: transform 0.8s ease-in-out;
        }
        .card:hover {
            transform: scale(1.05);
        }
        footer {
            position: relative;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>
<body>

<!-- Hero Section -->
<section class="bg-danger text-white text-center py-5">
    <h1>Blood Donation Management System</h1>
    <p>"Ensuring every patient receives the right blood at the right time..."</p>
</section>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="Home%20Page.html">Home</a></li>
                <li class="nav-item"><a class="nav-link active" href="Patient%20Dashboard.html">Patient Dashboard</a></li>
                <li class="nav-item"><a class="nav-link" href="#">Profile</a></li>
                <li class="nav-item"><a class="nav-link" href="LogOut.html">Logout</a></li>
            </ul>
        </div>
    </div>
</nav>

<!-- Dashboard Content -->
<div class="container mt-4">
    <div class="row">
        <!-- Patient Details Form -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Blood Recipient (Patient) Details</h5>
                    <form id="patientForm">
                        <div class="mb-3">
                            <label for="patientName" class="form-label">Patient Name</label>
                            <input type="text" class="form-control" id="patientName" required>
                        </div>
                        <div class="mb-3">
                            <label for="patientAge" class="form-label">Age</label>
                            <input type="number" class="form-control" id="patientAge" required>
                        </div>
                        <div class="mb-3">
                            <label for="bloodGroup" class="form-label">Blood Group</label>
                            <select class="form-select" id="bloodGroup" required>
                                <option value="">Select</option>
                                <option value="A+">A+</option>
                                <option value="A-">A-</option>
                                <option value="B+">B+</option>
                                <option value="B-">B-</option>
                                <option value="O+">O+</option>
                                <option value="O-">O-</option>
                                <option value="AB+">AB+</option>
                                <option value="AB-">AB-</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <div class="form-check-inline">
                                <label class="form-check-label" for="radio1">Gender :
                                    <input type="radio" class="form-check-input" id="radio1" name="optradio"
                                           value="Male" checked>Male
                                </label>
                            </div>
                            <div class="form-check-inline">
                                <label class="form-check-label" for="radio2">
                                    <input type="radio" class="form-check-input" id="radio2" name="optradio"
                                           value="Female">Female
                                </label>
                            </div>
                            <div class="form-check-inline">
                                <label class="form-check-label">
                                    <input type="radio" class="form-check-input" id="radio3" name="optradio"
                                           value="Others">Others
                                </label>
                            </div>
                        </div><br>
                        <!--<div class="mb-3">
                            <label class="form-label">Gender</label>
                            <div>
                                <input type="radio" name="gender" value="Male" checked> Male
                                <input type="radio" name="gender" value="Female"> Female
                                <input type="radio" name="gender" value="Other"> Other
                            </div>
                        </div>-->

                        <div class="mb-3">
                            <label for="contactNumber" class="form-label">Contact Number</label>
                            <input type="tel" class="form-control" id="contactNumber" required>
                        </div>

                        <!--District Selection-->
                        <div class="mb-3">
                            <label for="district" class="form-label">Select District</label>
                            <select class="form-select" id="district" required>
                                <option value="">Select</option>
                                <option value="Ampara">Ampara</option>
                                <option value="Anuradhapura">Anuradhapura</option>
                                <option value="Badulla">Badulla</option>
                                <option value="Batticaloa">Batticaloa</option>
                                <option value="Colombo">Colombo</option>
                                <option value="Galle">Galle</option>
                                <option value="Gampaha">Gampaha</option>
                                <option value="Hambantota">Hambantota</option>
                                <option value="Jaffna">Jaffna</option>
                                <option value="Kalutara">Kalutara</option>
                                <option value="Kandy">Kandy</option>
                                <option value="Kegalle">Kegalle</option>
                                <option value="Kilinochchi">Kilinochchi</option>
                                <option value="Kurunegala">Kurunegala</option>
                                <option value="Mannar">Mannar</option>
                                <option value="Matale">Matale</option>
                                <option value="Matara">Matara</option>
                                <option value="Monaragala">Monaragala</option>
                                <option value="Mullaitivu">Mullaitivu</option>
                                <option value="Nuwara Eliya">Nuwara Eliya</option>
                                <option value="Polonnaruwa">Polonnaruwa</option>
                                <option value="Puttalam">Puttalam</option>
                                <option value="Ratnapura">Ratnapura</option>
                                <option value="Trincomalee">Trincomalee</option>
                                <option value="Vavuniya">Vavuniya</option>
                            </select>
                        </div>


                        <!-- Hospital Selection -->
                        <div class="mb-3">
                            <label for="hospitalName" class="form-label">Hospital Name</label>
                            <select class="form-select" id="hospitalName" required>
                                <option value="">Select Hospital</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="email">Email address:</label>
                            <input type="email" class="form-control" id="email" placeholder="Enter your email"
                                   name="email" required>
                            <div class="valid-feedback">Valid.</div>
                            <div class="invalid-feedback">Please enter your email id.</div>
                        </div></br>

                        <div class="mb-3">
                            <label for="homeAddress" class="form-label">Home Address</label>
                            <input type="text" class="form-control" id="homeAddress" required>
                        </div>

                        <button type="submit" class="btn btn-danger">Submit Request</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Blood Recipient Instructions Leaflet -->
        <div class="col-md-6">
            <div class="card bg-light">
                <div class="card-body">
                    <h5 class="card-title">Instructions for Blood Recipients</h5>
                    <ul>
                        <li><strong>Before Transfusion:</strong> Ensure the blood type is a match and is cross-checked by medical staff.</li>
                        <li><strong>During Transfusion:</strong> Report any discomfort, chills, fever, or allergic reactions immediately.</li>
                        <li><strong>After Transfusion:</strong> Stay hydrated and rest for a few hours.</li>
                        <li><strong>Monitor Symptoms:</strong> If you experience fever, dizziness, or unusual reactions, inform your doctor.</li>
                        <li><strong>Follow-up:</strong> Attend follow-up check-ups as advised by your doctor.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Blood Availability Table -->
    <div class="col-md-12 mt-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title text-center" id="hospital-name">Hospital Name</h5>
                <table class="table table-bordered text-center">
                    <thead class="table-dark">
                    <tr>
                        <th>Blood Group</th>
                        <th>Number of pints of blood currently available in the hospital blood bank</th>
                    </tr>
                    </thead>
                    <tbody id="blood-availability">
                    <tr>
                        <td>A+</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>A-</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>B+</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>B-</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>O+</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>O-</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>AB+</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>AB-</td>
                        <td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>


</div>

<!-- Footer -->
<footer class="bg-dark text-white text-center py-3 mt-5">
    <div class="container">
        <p>&copy; 2025 Blood Donation Management System. All Rights Reserved.</p>
        <p>
            <a href="#" class="text-white text-decoration-none me-3">Privacy Policy</a> |
            <a href="#" class="text-white text-decoration-none me-3">Terms of Service</a> |
            <a href="About%20Us.html" class="text-white text-decoration-none">Contact Us</a>
        </p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.getElementById("patientForm").addEventListener("submit", function(event) {
        event.preventDefault();
        alert("Blood request submitted successfully!");
    });
</script>

<script>
    // Mapping of districts to their respective hospitals
    const hospitalsByDistrict = {
        "Colombo": ["Colombo National Hospital", "Nawaloka Hospital", "Asiri Central Hospital", "Base Hospital Colombo"],
        "Kandy": ["Kandy Teaching Hospital", "Peradeniya Hospital", "Base Hospital Kandy", "Pallekele Base Hospital"],
        "Galle": ["Karapitiya Teaching Hospital", "Mahinda Rajapaksa Hospital", "Base Hospital Galle"],
        "Jaffna": ["Jaffna Teaching Hospital", "Base Hospital Jaffna", "Base Hospital Point Pedro"],
        "Gampaha": ["Gampaha District General Hospital", "Wathupitiwala Base Hospital", "Base Hospital Gampaha"],
        "Kurunegala": ["Kurunegala Teaching Hospital", "Polgahawela District Hospital", "Base Hospital Kurunegala"],
        "Anuradhapura": ["Anuradhapura Teaching Hospital", "Base Hospital Anuradhapura"],
        "Badulla": ["Badulla General Hospital", "Base Hospital Badulla"],
        "Batticaloa": ["Batticaloa General Hospital", "Base Hospital Batticaloa"],
        "Matara": ["Matara General Hospital", "Base Hospital Matara"],
        "Nuwara Eliya": ["Nuwara Eliya General Hospital", "Base Hospital Nuwara Eliya"],
        "Ratnapura": ["Ratnapura General Hospital"],
        "Trincomalee": ["Trincomalee General Hospital"],
        "Vavuniya": ["Vavuniya District Hospital"],
        "Mannar": ["Base Hospital Mannar"],
        "Kilinochchi": ["Kilinochchi District General Hospital", "Base Hospital Kilinochchi"],
        "Polonnaruwa": ["Polonnaruwa General Hospital", "Base Hospital Polonnaruwa"],
        "Matale": ["Matale General Hospital", "Base Hospital Matale"],
        "Mullaitivu": ["Mullaitivu District General Hospital", "Base Hospital Mullaitivu"],
        "Puttalam": ["Puttalam General Hospital", "Base Hospital Puttalam"],
        "Monaragala": ["Monaragala General Hospital", "Base Hospital Monaragala"],
        "Hambantota": ["Hambantota General Hospital"],
        "Kegalle": ["Kegalle General Hospital"],
        "Kalutara": ["Kalutara General Hospital", "Base Hospital Panadura"],
        "Mahiyanganaya": ["Mahiyanganaya District Hospital"],
        "Ampara": ["Base Hospital Ampara"]
    };



    document.getElementById("district").addEventListener("change", function () {
        const district = this.value;
        const hospitalSelect = document.getElementById("hospitalName");

        // Clear existing options
        hospitalSelect.innerHTML = '<option value="">Select Hospital</option>';

        // If the district has hospitals, add them to the dropdown
        if (district in hospitalsByDistrict) {
            hospitalsByDistrict[district].forEach(hospital => {
                let option = document.createElement("option");
                option.value = hospital;
                option.textContent = hospital;
                hospitalSelect.appendChild(option);
            });
        }
    });

    document.getElementById("patientForm").addEventListener("submit", function(event) {
        event.preventDefault();
        alert("Blood request submitted successfully!");
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<!--<script>
    // Mapping of hospitals to their blood bank availability
    const hospitalBloodAvailability = {
        "Colombo National Hospital": {
            "A+": 5,
            "A-": 3,
            "B+": 4,
            "B-": 2,
            "O+": 8,
            "O-": 1,
            "AB+": 2,
            "AB-": 1
        },
        "Kandy Teaching Hospital": {
            "A+": 7,
            "A-": 2,
            "B+": 5,
            "B-": 3,
            "O+": 6,
            "O-": 0,
            "AB+": 4,
            "AB-": 2
        },
        "Galle": {
            "A+": 6,
            "A-": 3,
            "B+": 5,
            "B-": 4,
            "O+": 7,
            "O-": 3,
            "AB+": 1,
            "AB-": 1
        }
    };

    document.getElementById("district").addEventListener("change", function () {
        const district = this.value;
        const hospitalSelect = document.getElementById("hospitalName");

        // Clear existing options
        hospitalSelect.innerHTML = '<option value="">Select Hospital</option>';

        // If the district has hospitals, add them to the dropdown
        if (district === "Colombo") {
            let hospitals = ["Colombo National Hospital", "Nawaloka Hospital", "Asiri Central Hospital"];
            hospitals.forEach(hospital => {
                let option = document.createElement("option");
                option.value = hospital;
                option.textContent = hospital;
                hospitalSelect.appendChild(option);
            });
        }
    });

    document.getElementById("hospitalName").addEventListener("change", function () {
        const selectedHospital = this.value;
        const hospitalName = document.getElementById("hospital-name");
        const bloodAvailabilityTable = document.getElementById("blood-availability");

        // Update the hospital name in the table
        hospitalName.textContent = selectedHospital;

        // Clear the table
        for (let row of bloodAvailabilityTable.rows) {
            row.cells[1].textContent = "";
        }

        // Populate the blood availability table based on the selected hospital
        if (selectedHospital in hospitalBloodAvailability) {
            const availability = hospitalBloodAvailability[selectedHospital];
            for (let i = 0; i < bloodAvailabilityTable.rows.length; i++) {
                let bloodGroup = bloodAvailabilityTable.rows[i].cells[0].textContent;
                if (availability[bloodGroup]) {
                    bloodAvailabilityTable.rows[i].cells[1].textContent = availability[bloodGroup];
                }
            }
        }
    });
</script>-->
<script>
    const BASE_URL = "http://localhost:8080/api/v1/patients";

    // Get All Patients
    const getAllPatients = () => {
        $.ajax({
            url: `${BASE_URL}/getAll`,
            type: "GET",
            success: (resp) => {
                let tableBody = $("#patient_table_body");
                tableBody.empty();
                resp.forEach((patient) => {
                    let row = `<tr>
                                    <td>${patient.id}</td>
                                    <td>${patient.patientName}</td>
                                    <td>${patient.age}</td>
                                    <td>${patient.bloodGroup}</td>
                                    <td>${patient.gender}</td>
                                    <td>${patient.contactNumber}</td>
                                    <td>${patient.district}</td>
                                    <td>${patient.hospitalName}</td>
                                    <td>${patient.email}</td>
                                    <td>${patient.homeAddress}</td>
                                    <td>
                                        <button class="btn btn-warning btn-sm" onclick="editPatient(${patient.id})">Edit</button>
                                        <button class="btn btn-danger btn-sm" onclick="deletePatient(${patient.id})">Delete</button>
                                    </td>
                               </tr>`;
                    tableBody.append(row);
                });
            },
            error: (err) => {
                console.error("Error fetching patients: ", err);
            }
        });
    };

    // Register Patient
    $("#patientForm").submit((event) => {
        event.preventDefault();

        let patient = {
            patientName: $("#patientName").val(),
            age: $("#patientAge").val(),
            bloodGroup: $("#bloodGroup").val(),
            gender: $("input[name='gender']:checked").val(),
            contactNumber: $("#contactNumber").val(),
            district: $("#district").val(),
            email: $("#email").val(),
            homeAddress: $("#homeAddress").val(),
            hospitalName: $("#hospitalName").val(),
            requiredPints: $("#requiredPints").val(),
            urgencyLevel: $("#urgencyLevel").val()
        };

        $.ajax({
            url: `${BASE_URL}/register`,
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(patient),
            success: () => {
                alert("Patient registered successfully.");
                getAllPatients();
                $("#patientForm")[0].reset();
            },
            error: (err) => {
                console.error("Error registering patient: ", err);
                alert("Failed to register patient.");
            }
        });
    });

    // Edit Patient (Fetch Patient Data for Update)
    const editPatient = (id) => {
        $.ajax({
            url: `${BASE_URL}/${id}`,
            type: "GET",
            success: (patient) => {
                $("#patientName").val(patient.patientName);
                $("#patientAge").val(patient.age);
                $("#bloodGroup").val(patient.bloodGroup);
                $(`input[name='gender'][value='${patient.gender}']`).prop("checked", true);
                $("#contactNumber").val(patient.contactNumber);
                $("#district").val(patient.district);
                $("#email").val(patient.email);
                $("#homeAddress").val(patient.homeAddress);
                $("#hospitalName").val(patient.hospitalName);
                $("#requiredPints").val(patient.requiredPints);
                $("#urgencyLevel").val(patient.urgencyLevel);
                $("#patientId").val(patient.id); // Hidden field for patient ID
            },
            error: (err) => {
                console.error("Error fetching patient data: ", err);
            }
        });
    };

    // Update Patient
    $("#btn_update_patient").click(() => {
        let patientId = $("#patientId").val();
        let patient = {
            id: patientId,
            patientName: $("#patientName").val(),
            age: $("#patientAge").val(),
            bloodGroup: $("#bloodGroup").val(),
            gender: $("input[name='gender']:checked").val(),
            contactNumber: $("#contactNumber").val(),
            district: $("#district").val(),
            email: $("#email").val(),
            homeAddress: $("#homeAddress").val(),
            hospitalName: $("#hospitalName").val(),
            requiredPints: $("#requiredPints").val(),
            urgencyLevel: $("#urgencyLevel").val()
        };

        $.ajax({
            url: `${BASE_URL}/${patientId}`,
            type: "PUT",
            contentType: "application/json",
            data: JSON.stringify(patient),
            success: () => {
                alert("Patient updated successfully.");
                getAllPatients();
                $("#patientForm")[0].reset();
            },
            error: (err) => {
                console.error("Error updating patient: ", err);
                alert("Failed to update patient.");
            }
        });
    });

    // Delete Patient
    const deletePatient = (id) => {
        if (confirm("Are you sure you want to delete this patient?")) {
            $.ajax({
                url: `${BASE_URL}/${id}`,
                type: "DELETE",
                success: () => {
                    alert("Patient deleted successfully.");
                    getAllPatients();
                },
                error: (err) => {
                    console.error("Error deleting patient: ", err);
                    alert("Failed to delete patient.");
                }
            });
        }
    };

    // Initial load of patients
    getAllPatients();
</script>

</body>
</html>
